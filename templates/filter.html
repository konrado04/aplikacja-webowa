<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Filtruj projekty</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <div class="container">
        <h1>Filtruj projekty</h1>
        {% if error %}
        <p class="error-message">{{ error }}</p>
        {% endif %}
        <form method="POST" action="{{ url_for('filter_projects') }}">
            <label for="feature">Cecha:</label>
            <select id="feature" name="feature" onchange="updateValues()">
                <option value="" {% if not filters.feature %}selected{% endif %}>Wybierz cechę...</option>
                {% for feature in available_features.keys() %}
                <option value="{{ feature }}" {% if filters.feature == feature %}selected{% endif %}>{{ feature }}</option>
                {% endfor %}
            </select>

            <label for="value">Wartość:</label>
            <select id="value" name="value">
                <option value="" {% if not filters.value %}selected{% endif %}>Wybierz wartość...</option>
                {% if filters.feature %}
                {% for value in available_features[filters.feature] %}
                <option value="{{ value }}" {% if filters.value == value %}selected{% endif %}>{{ value }}</option>
                {% endfor %}
                {% endif %}
            </select>

            <input type="submit" value="Filtruj">
        </form>
        {% if filtered_projects %}
        <table>
            <tr>
                <th>Symbol</th>
                <th>Nazwa</th>
                <th>ID</th>
            </tr>
            {% for symbol, details in filtered_projects.items() %}
            <tr>
                <td><a href="{{ url_for('project_details', symbol=symbol) }}">{{ symbol }}</a></td>
                <td>{{ details.Nazwa }}</td>
                <td>{{ details.ID }}</td>
            </tr>
            {% endfor %}
        </table>
        {% else %}
        <p class="no-projects">Brak projektów spełniających kryteria.</p>
        {% endif %}
        <div class="nav-links">
            <a href="{{ url_for('index') }}">Powrót do listy projektów</a>
        </div>
    </div>
    <script>
        function updateValues() {
            var featureSelect = document.getElementById('feature');
            var valueSelect = document.getElementById('value');
            var feature = featureSelect.value;
            valueSelect.innerHTML = '<option value="" selected>Wybierz wartość...</option>';
            if (feature) {
                var features = {{ available_features | tojson }};
                features[feature].forEach(function(value) {
                    var option = document.createElement('option');
                    option.value = value;
                    option.text = value;
                    valueSelect.appendChild(option);
                });
            }
        }
    </script>
</body>
</html>